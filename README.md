# Stock Market Analysis Project

A Python-based project for analyzing publicly available stock market data using free APIs and data sources.

## Features

- **Data Fetching**: Retrieve historical stock price data from Yahoo Finance
- **Technical Analysis**: 
  - Moving Averages (SMA, EMA)
  - Relative Strength Index (RSI)
  - MACD (Moving Average Convergence Divergence)
  - Bollinger Bands
  - Support & Resistance Levels
- **Performance Metrics**:
  - Total Return calculation
  - Volatility analysis
  - Sharpe Ratio
  - Trend identification
- **Multi-stock Analysis**: Analyze and compare multiple stocks
- **Data Persistence**: Save and load data from CSV files
 - **Data Persistence**: Save and load data from Parquet files (efficient, compressed storage)

## Project Structure

```
stock_analysis/
├── src/
│   ├── data_fetcher.py        # Stock data retrieval module
│   ├── cache_manager.py       # Parquet caching and metadata
│   ├── analyzer.py            # Technical analysis indicators
│   └── stock_list.py          # ~100 stock symbols
├── data/                      # Downloaded Parquet files (daily & 1m intraday)
├── trained_algorithm.json     # Saved day-trading algorithm (generated by day_trading_backtest.py)
├── config.py                  # Trading parameters (entry/exit rules, costs, hours)
├── fetch_all.py               # Download runner (daily 10y + available 1m)
├── run_download.py            # Helper to force a fresh download
├── day_trading_backtest.py    # Day-trading algorithm (train on daily, test on 1m)
├── example.py                 # Example analysis script (optional)
├── requirements.txt           # Python dependencies
└── README.md                  # This file
```

## Installation

1. Clone or download the project

2. Recommended: create and use a Python virtual environment (`venv`). This keeps project dependencies isolated.

  - Windows (PowerShell / `pwsh`):

  ```powershell
  python -m venv .venv
  .\.venv\Scripts\Activate.ps1
  python -m pip install --upgrade pip
  pip install -r requirements.txt
  ```

  - Windows (cmd):

  ```cmd
  python -m venv .venv
  .\.venv\Scripts\activate.bat
  python -m pip install --upgrade pip
  pip install -r requirements.txt
  ```

  - macOS / Linux (bash / zsh):

  ```bash
  python3 -m venv .venv
  source .venv/bin/activate
  python -m pip install --upgrade pip
  pip install -r requirements.txt
  ```

  Recommended Python: `3.10` or newer (this project was developed and tested with Python `3.12`).

3. To deactivate the virtual environment:

  ```bash
  deactivate
  ```

## Usage

### Basic Example

```python
from src.data_fetcher import StockDataFetcher
from src.analyzer import StockAnalyzer

# Fetch data (Parquet cache is used when available)
fetcher = StockDataFetcher()
df = fetcher.fetch_yahoo_historical('AAPL')

# Analyze
analyzer = StockAnalyzer(df)
summary = analyzer.get_performance_summary()
print(summary)
```

### Downloading data and running the day-trading backtest

Fetch data (daily 10y + available 1m intraday) and store as Parquet:

```powershell
python fetch_all.py
```

Force a fresh 1m download (uses example helper):

```powershell
python run_download.py
```

Run the day-trading backtest (train on daily, test on last 7 days of 1m):

```powershell
python day_trading_backtest.py
```

- **First run**: Trains the algorithm on 10 years of daily data and saves it to `trained_algorithm.json`
- **Subsequent runs**: Loads the saved algorithm from `trained_algorithm.json` (faster) and immediately backtests
  - Shows real-time progress as each symbol is backtested
  - Displays: symbol, trade count, win rate, and P&L for each candidate
- **To retrain**: Force a fresh training run:
  ```powershell
  python day_trading_backtest.py --retrain
  ```

**Configuration**: All trading parameters (entry/exit rules, costs, trading hours) are in `config.py`. Adjust them to tune the algorithm:

```python
# Example adjustments
PROFIT_TARGET_PCT = 1.0       # Change from 0.8% to 1.0%
STOP_LOSS_PCT = 0.3           # Tighter stop loss
COMMISSION_PER_TRADE = 0.001  # Percentage commission
COMMISSION_FLAT_RATE = 2.0    # Flat rate per trade in dollars
```

After editing `config.py`, run the backtest again to see how changes affect results.

`example.py` remains as a lighter demo for analysis and exploratory usage.

### Convenience helper (Windows PowerShell)

There is a small helper script at `scripts/setup_venv.ps1` that automates creating the `.venv`, activating it in the current PowerShell session, upgrading `pip`, and installing `requirements.txt`.

To run it from PowerShell (in the project root):

```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\scripts\setup_venv.ps1
```

This script is optional but useful if you're primarily developing on Windows with PowerShell.

### `StockAnalyzer`

Methods:
- `calculate_moving_average(window)` - Simple Moving Average
- `calculate_exponential_moving_average(window)` - Exponential Moving Average
- `calculate_rsi(window)` - Relative Strength Index
- `calculate_macd()` - MACD indicator
- `calculate_bollinger_bands()` - Bollinger Bands
- `calculate_returns(period)` - Percentage returns
- `calculate_volatility(window)` - Rolling volatility
- `get_performance_summary()` - Comprehensive metrics
- `identify_trends()` - Trend analysis
- `find_support_resistance()` - Support/Resistance levels

## Configuration

Edit `config.py` to customize trading behavior:

### Entry Signals
- `RSI_OVERSOLD_THRESHOLD` (default: 35) - RSI level that triggers buy signals
- `SMA_PERIOD` (default: 5) - Short-term moving average period in minutes

### Exit Rules
- `PROFIT_TARGET_PCT` (default: 0.8) - Exit at this profit % (e.g., +0.8%)
- `STOP_LOSS_PCT` (default: 0.5) - Exit at this loss % (e.g., -0.5%)
- `MAX_HOLD_TIME_MINUTES` (default: 480) - Close position after this many minutes
- `LARGE_MOVE_EXIT_PCT` (default: 2.0) - Exit if price moves beyond this %

### Trading Hours
- `TRADING_START_HOUR` / `TRADING_START_MINUTE` (default: 9:30) - Start trading
- `TRADING_END_HOUR` / `TRADING_END_MINUTE` (default: 16:00) - Stop trading

### Costs & Slippage
- `COMMISSION_PER_TRADE` (default: 0.001) - Percentage commission (0.1%)
  - Set to 0 to disable
- `COMMISSION_FLAT_RATE` (default: 1.0) - Fixed $ per trade
  - Set to 0 to disable
- `SLIPPAGE_PCT` (default: 0.01) - Expected slippage as %

### Trade Filters
- `MIN_VOLATILITY` (default: 0.10) - Skip stocks with <10% annual volatility
- `REQUIRE_UPTREND` (default: True) - Only trade stocks in uptrend
- `MIN_TRADES_TO_REPORT` (default: 3) - Minimum trades to include in results

## Data Sources

-- **Yahoo Finance**: Free historical stock data via unofficial API
  - No API key required
  - Daily data is available for long lookbacks (10+ years)
  - Intraday 1-minute data is limited to recent windows (typically ~5–7 days)
  - Includes OHLCV (Open, High, Low, Close, Volume) data

## Notes

-- Data is fetched from publicly available sources
-- No paid API keys or subscriptions required
-- Important notes:
  - 1-minute intraday history from free providers is limited (commonly ~5–7 days). The code truncates requests automatically to available windows.
  - This project now stores cached data in Parquet format for efficiency.
-- For production use, consider implementing:
  - Error handling and retry logic
  - Monitoring and observability
  - Slippage and commission modeling for backtests
  - More robust data sources for full historical intraday data

## Common Stock Symbols

- AAPL - Apple Inc.
- MSFT - Microsoft Corporation
- GOOGL - Alphabet Inc.
- AMZN - Amazon.com Inc.
- TSLA - Tesla Inc.
- META - Meta Platforms Inc.
- NVDA - NVIDIA Corporation

## Disclaimer

This project is for educational purposes. Stock market analysis involves risk, and past performance does not guarantee future results. Always do your own research before making investment decisions.
