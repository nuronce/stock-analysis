# Stock Market Analysis Project

A Python-based project for analyzing publicly available stock market data using free APIs and data sources.

## Features

- **Data Fetching**: Retrieve historical stock price data from Yahoo Finance
- **Technical Analysis**: 
  - Moving Averages (SMA, EMA)
  - Relative Strength Index (RSI)
  - MACD (Moving Average Convergence Divergence)
  - Bollinger Bands
  - Support & Resistance Levels
- **Performance Metrics**:
  - Total Return calculation
  - Volatility analysis
  - Sharpe Ratio
  - Trend identification
- **Multi-stock Analysis**: Analyze and compare multiple stocks
- **Data Persistence**: Save and load data from CSV files
 - **Data Persistence**: Save and load data from Parquet files (efficient, compressed storage)

## Project Structure

```
stock_analysis/
├── src/
│   ├── data_fetcher.py    # Stock data retrieval module
│   └── analyzer.py        # Technical analysis module
├── data/                  # Directory for downloaded Parquet data
├── trained_algorithm.json # Saved day-trading algorithm (generated by day_trading_backtest.py)
├── fetch_all.py           # Download runner (daily 10y + available 1m)
├── run_download.py        # Helper to force a fresh download (calls example helper)
├── day_trading_backtest.py# Day-trading algorithm (train on daily, test on 1m)
├── example.py             # Example analysis script (optional)
├── requirements.txt       # Python dependencies
└── README.md              # This file
```

## Installation

1. Clone or download the project

2. Recommended: create and use a Python virtual environment (`venv`). This keeps project dependencies isolated.

  - Windows (PowerShell / `pwsh`):

  ```powershell
  python -m venv .venv
  .\.venv\Scripts\Activate.ps1
  python -m pip install --upgrade pip
  pip install -r requirements.txt
  ```

  - Windows (cmd):

  ```cmd
  python -m venv .venv
  .\.venv\Scripts\activate.bat
  python -m pip install --upgrade pip
  pip install -r requirements.txt
  ```

  - macOS / Linux (bash / zsh):

  ```bash
  python3 -m venv .venv
  source .venv/bin/activate
  python -m pip install --upgrade pip
  pip install -r requirements.txt
  ```

  Recommended Python: `3.10` or newer (this project was developed and tested with Python `3.12`).

3. To deactivate the virtual environment:

  ```bash
  deactivate
  ```

## Usage

### Basic Example

```python
from src.data_fetcher import StockDataFetcher
from src.analyzer import StockAnalyzer

# Fetch data (Parquet cache is used when available)
fetcher = StockDataFetcher()
df = fetcher.fetch_yahoo_historical('AAPL')

# Analyze
analyzer = StockAnalyzer(df)
summary = analyzer.get_performance_summary()
print(summary)
```

### Downloading data and running the day-trading backtest

Fetch data (daily 10y + available 1m intraday) and store as Parquet:

```powershell
python fetch_all.py
```

Force a fresh 1m download (uses example helper):

```powershell
python run_download.py
```

Run the day-trading backtest (train on daily, test on last 7 days of 1m):

```powershell
python day_trading_backtest.py
```

- **First run**: Trains the algorithm on 10 years of daily data and saves it to `trained_algorithm.json`
- **Subsequent runs**: Loads the saved algorithm from `trained_algorithm.json` (faster) and prompts whether to reuse or retrain
  - Press ENTER to use the existing algorithm
  - Type `retrain` to re-analyze daily data and update the algorithm

`example.py` remains as a lighter demo for analysis and exploratory usage.

### Convenience helper (Windows PowerShell)

There is a small helper script at `scripts/setup_venv.ps1` that automates creating the `.venv`, activating it in the current PowerShell session, upgrading `pip`, and installing `requirements.txt`.

To run it from PowerShell (in the project root):

```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\scripts\setup_venv.ps1
```

This script is optional but useful if you're primarily developing on Windows with PowerShell.

## Key Modules

### `StockDataFetcher` & `CacheManager`

Key functionality:
- `fetch_yahoo_historical(symbol, start_date, end_date, interval)` - Fetch historical data via `yfinance`.
- `fetch_multiple_symbols(symbols)` - Fetch data for multiple tickers with rate limiting.
- `CacheManager` (in `src/cache_manager.py`) handles Parquet caching and `data/index.json` metadata.
- Data is stored as Parquet files named `<SYMBOL>_<freq>.parquet` (e.g., `AAPL_daily.parquet`, `AAPL_1m.parquet`).

### `StockAnalyzer`

Methods:
- `calculate_moving_average(window)` - Simple Moving Average
- `calculate_exponential_moving_average(window)` - Exponential Moving Average
- `calculate_rsi(window)` - Relative Strength Index
- `calculate_macd()` - MACD indicator
- `calculate_bollinger_bands()` - Bollinger Bands
- `calculate_returns(period)` - Percentage returns
- `calculate_volatility(window)` - Rolling volatility
- `get_performance_summary()` - Comprehensive metrics
- `identify_trends()` - Trend analysis
- `find_support_resistance()` - Support/Resistance levels

## Data Sources

-- **Yahoo Finance**: Free historical stock data via unofficial API
  - No API key required
  - Daily data is available for long lookbacks (10+ years)
  - Intraday 1-minute data is limited to recent windows (typically ~5–7 days)
  - Includes OHLCV (Open, High, Low, Close, Volume) data

## Notes

-- Data is fetched from publicly available sources
-- No paid API keys or subscriptions required
-- Important notes:
  - 1-minute intraday history from free providers is limited (commonly ~5–7 days). The code truncates requests automatically to available windows.
  - This project now stores cached data in Parquet format for efficiency.
-- For production use, consider implementing:
  - Error handling and retry logic
  - Monitoring and observability
  - Slippage and commission modeling for backtests
  - More robust data sources for full historical intraday data

## Common Stock Symbols

- AAPL - Apple Inc.
- MSFT - Microsoft Corporation
- GOOGL - Alphabet Inc.
- AMZN - Amazon.com Inc.
- TSLA - Tesla Inc.
- META - Meta Platforms Inc.
- NVDA - NVIDIA Corporation

## Disclaimer

This project is for educational purposes. Stock market analysis involves risk, and past performance does not guarantee future results. Always do your own research before making investment decisions.
